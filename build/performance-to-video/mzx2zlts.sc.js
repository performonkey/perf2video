/*! Built with http://stenciljs.com */
const{h:e}=window.PerformanceToVideo;var t=function(e,t,s,i){return new(s||(s=Promise))(function(r,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new s(function(t){t(e.value)}).then(n,a)}l((i=i.apply(e,t||[])).next())})};function s(e){return new Promise((t,s)=>{const i=new Image;i.onload=(()=>t({width:i.width,height:i.height,img:i,ts:e.ts,tts:e.tts})),i.onerror=s,i.src=`data:image/png;base64,${e.args.snapshot}`})}class i{constructor(){this.handleChange=(e=>{const{onLoadProfile:i,p2vLoadProfileFailed:r,p2vProgressUpdate:o}=this;o.emit({title:"Read Profile"});const n=new FileReader;n.addEventListener("progress",e=>{const t=Math.trunc(e.loaded/e.total*100);o.emit({show:!0,title:`Read Profile (${t}%)`})}),n.addEventListener("error",r.emit),n.onload=function(){return t(this,void 0,void 0,function*(){let e,t;try{e=JSON.parse(this.result)}catch(e){return void r.emit(e)}try{t=yield Promise.all(e.filter(e=>"Screenshot"===e.name).map(s))}catch(e){return void r.emit(e)}i(new CustomEvent("screenshots",{detail:t}))})},n.readAsText(e.target.files[0])})}render(){return e("div",null,e("label",{class:"upload",htmlFor:"load-profile"},e("figure",null,e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"17",viewBox:"0 0 20 17"},e("path",{d:"M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"}))),e("span",null,"Choose a Proformance Profile")),e("input",{id:"load-profile",class:"file-input",type:"file",onChange:this.handleChange}))}static get is(){return"p2v-load-profile"}static get encapsulation(){return"shadow"}static get properties(){return{onLoadProfile:{type:"Any",attr:"on-load-profile"}}}static get events(){return[{name:"p2vProgressUpdate",method:"p2vProgressUpdate",bubbles:!0,cancelable:!0,composed:!0},{name:"p2vLoadProfileFailed",method:"p2vLoadProfileFailed",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".upload[data-p2v-load-profile]{font-size:1.25rem;font-weight:700;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;display:inline-block;overflow:hidden;padding:.625rem 1.25rem;color:#d3394c}.upload[data-p2v-load-profile]   figure[data-p2v-load-profile]{width:100px;height:100px;border-radius:50%;background-color:#d3394c;display:block;padding:20px;margin:0 auto 10px}.upload[data-p2v-load-profile]   svg[data-p2v-load-profile]{width:100%;height:100%;fill:#f1e5e6;vertical-align:middle;margin-top:-.25em;margin-right:.25em}.upload[data-p2v-load-profile]   span[data-p2v-load-profile]{font-variant-caps:small-caps;user-select:none}.file-input[data-p2v-load-profile]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}"}}class r{constructor(){this.title="",this.message=""}render(){return e("div",{class:"progress"},e("div",{class:"title"},this.title),e("div",{class:"message"},this.message))}static get is(){return"p2v-progress"}static get encapsulation(){return"shadow"}static get properties(){return{message:{type:String,attr:"message"},title:{type:String,attr:"title"}}}static get events(){return[{name:"onCloseProgress",method:"onCloseProgress",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".progress[data-p2v-progress]{width:460px;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:20px 0;border-radius:2px;box-shadow:0 4px 12px rgba(0,0,0,.15)}.title[data-p2v-progress]{font-family:Avenir;font-size:2rem;font-weight:700;font-variant-caps:small-caps;color:#7fffd4}"}}var o,n=(function(e){!function(){var t={}.hasOwnProperty;function s(){for(var e=[],i=0;i<arguments.length;i++){var r=arguments[i];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r))e.push(s.apply(null,r));else if("object"===o)for(var n in r)t.call(r,n)&&r[n]&&e.push(n)}}return e.join(" ")}e.exports?e.exports=s:window.classNames=s}()}(o={exports:{}}),o.exports),a=function(e,t,s,i){return new(s||(s=Promise))(function(r,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new s(function(t){t(e.value)}).then(n,a)}l((i=i.apply(e,t||[])).next())})};class l{constructor(){this.screenshots=[],this.encodeVideo=(e=>{const t=new Blob(e);this.videoUrl=URL.createObjectURL(t)}),this.painting=(e=>new Promise(t=>{const s=(i=0)=>{i>=e.length?t():(this.context.fillStyle="rgb(255,255,255)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(e[i].img,0,0),setTimeout(()=>s(i+1),this.settings.frameRate))};s()}))}componentDidLoad(){this.canvas=this.recordEl.shadowRoot.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.video=this.recordEl.shadowRoot.querySelector("video"),this.video.addEventListener("end",()=>URL.revokeObjectURL(this.videoUrl))}screenshotsUpdate(e,t){return a(this,void 0,void 0,function*(){if(e===t||0===e.length)return;this.p2vProgressUpdate.emit({show:!0,title:"Recording..."}),this.videoUrl="";const s=e,i=s.reduce((e,t)=>e.width>t.width?e:t).width,r=s.reduce((e,t)=>e.height>t.height?e:t).height;this.canvas.width=i,this.canvas.height=r;const o=new MediaRecorder(this.canvas.captureStream(this.settings.frameRate),{mimeType:this.settings.videoType});o.ondataavailable=(e=>this.encodeVideo([e.data])),o.start(),yield this.painting(s),o.stop(),this.p2vProgressUpdate.emit({show:!1})})}render(){return e("div",null,e("video",{controls:!0,class:n({hide:!this.videoUrl}),src:this.videoUrl}),e("canvas",{class:n({hide:this.videoUrl})}))}static get is(){return"p2v-record"}static get encapsulation(){return"shadow"}static get properties(){return{canvas:{state:!0},context:{state:!0},recordEl:{elementRef:!0},screenshots:{type:"Any",attr:"screenshots",watchCallbacks:["screenshotsUpdate"]},settings:{type:"Any",attr:"settings"},video:{state:!0},videoUrl:{state:!0}}}static get events(){return[{name:"p2vProgressUpdate",method:"p2vProgressUpdate",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".hide[data-p2v-record]{display:none}"}}const c=["video/webm","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm;codecs=h264","video/mpeg"].filter(e=>MediaRecorder.isTypeSupported(e));class d{componentDidLoad(){this.p2vSettingsUpdate.emit(Object.assign({},this.settings,{videType:c[0]}))}render(){return e("div",null,e("div",{class:"setting-field"},e("div",{class:"setting-name"},"Frame Rate"),e("input",{type:"number",value:this.settings.frameRate})),e("div",{class:"setting-field"},e("div",{class:"setting-name"},"Video Codec"),e("select",null,c.map(t=>e("option",{value:t,selected:this.settings.videoType===t},t)))))}static get is(){return"p2v-settings"}static get encapsulation(){return"shadow"}static get properties(){return{settings:{type:"Any",attr:"settings"}}}static get events(){return[{name:"p2vSettingsUpdate",method:"p2vSettingsUpdate",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".setting-field[data-p2v-settings]{margin-bottom:10px}.setting-field[data-p2v-settings]:last-child{margin-bottom:0}.setting-name[data-p2v-settings]{font-size:14px}"}}class h{constructor(){this.progress={show:!1,title:"",message:""},this.settings={frameRate:16,videoType:""},this.handleLoadProfile=(e=>{this.screenshots=e.detail})}updateProgress(e){this.progress=e.detail}progressFailed(e){console.log("profileLoadFailed: ",e.detail)}p2vSettingsUpdate(e){this.settings=e.detail}render(){return e("div",{class:"performance-to-video"},e("p2v-settings",{class:"settings",settings:this.settings}),e("p2v-load-profile",{onLoadProfile:this.handleLoadProfile}),e("p2v-progress",{class:n("p2v-progress",{show:this.progress.show}),title:this.progress.title,message:this.progress.message}),e("p2v-record",{class:n("record",{collapsed:!this.screenshots}),settings:this.settings,screenshots:this.screenshots}))}static get is(){return"performance-to-video"}static get encapsulation(){return"shadow"}static get properties(){return{progress:{state:!0},screenshots:{state:!0},settings:{state:!0}}}static get style(){return".performance-to-video[data-performance-to-video]{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.p2v-progress[data-performance-to-video]{position:fixed;display:flex;top:-100%;width:100%;height:100%;opacity:0;overflow:hidden;box-sizing:border-box;align-items:center;justify-content:center;transition:all ease .3s}.p2v-progress.show[data-performance-to-video]{opacity:1;top:0}.collapsed[data-performance-to-video]{height:0}.settings[data-performance-to-video]{position:fixed;top:20px;right:20px;background:#f8f8f8;box-shadow:0 0 1px #0000001f;padding:20px;border-radius:2px}"}}export{i as P2vLoadProfile,r as P2vProgress,l as P2vRecord,d as P2vSettings,h as PerformanceToVideo};