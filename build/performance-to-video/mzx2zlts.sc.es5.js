/*! Built with http://stenciljs.com */
var __generator=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};PerformanceToVideo.loadBundle("mzx2zlts",["exports"],function(e){var t=window.PerformanceToVideo.h,n=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};function r(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){return t({width:r.width,height:r.height,img:r,ts:e.ts,tts:e.tts})},r.onerror=n,r.src="data:image/png;base64,"+e.args.snapshot})}var o,i=function(){function e(){var e=this;this.handleChange=function(t){var o=e,i=o.onLoadProfile,s=o.p2vLoadProfileFailed,a=o.p2vProgressUpdate;a.emit({title:"Read Profile"});var c=new FileReader;c.addEventListener("progress",function(e){var t=Math.trunc(e.loaded/e.total*100);a.emit({show:!0,title:"Read Profile ("+t+"%)"})}),c.addEventListener("error",s.emit),c.onload=function(){return n(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:try{e=JSON.parse(this.result)}catch(e){return s.emit(e),[2]}o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all(e.filter(function(e){return"Screenshot"===e.name}).map(r))];case 2:return t=o.sent(),[3,4];case 3:return n=o.sent(),s.emit(n),[2];case 4:return i(new CustomEvent("screenshots",{detail:t})),[2]}})})},c.readAsText(t.target.files[0])}}return e.prototype.render=function(){return t("div",null,t("label",{class:"upload",htmlFor:"load-profile"},t("figure",null,t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"17",viewBox:"0 0 20 17"},t("path",{d:"M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"}))),t("span",null,"Choose a Proformance Profile")),t("input",{id:"load-profile",class:"file-input",type:"file",onChange:this.handleChange}))},Object.defineProperty(e,"is",{get:function(){return"p2v-load-profile"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{onLoadProfile:{type:"Any",attr:"on-load-profile"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"p2vProgressUpdate",method:"p2vProgressUpdate",bubbles:!0,cancelable:!0,composed:!0},{name:"p2vLoadProfileFailed",method:"p2vLoadProfileFailed",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".upload[data-p2v-load-profile]{font-size:1.25rem;font-weight:700;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;display:inline-block;overflow:hidden;padding:.625rem 1.25rem;color:#d3394c}.upload[data-p2v-load-profile]   figure[data-p2v-load-profile]{width:100px;height:100px;border-radius:50%;background-color:#d3394c;display:block;padding:20px;margin:0 auto 10px}.upload[data-p2v-load-profile]   svg[data-p2v-load-profile]{width:100%;height:100%;fill:#f1e5e6;vertical-align:middle;margin-top:-.25em;margin-right:.25em}.upload[data-p2v-load-profile]   span[data-p2v-load-profile]{font-variant-caps:small-caps;user-select:none}.file-input[data-p2v-load-profile]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}"},enumerable:!0,configurable:!0}),e}(),s=function(){function e(){this.title="",this.message=""}return e.prototype.render=function(){return t("div",{class:"progress"},t("div",{class:"title"},this.title),t("div",{class:"message"},this.message))},Object.defineProperty(e,"is",{get:function(){return"p2v-progress"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{message:{type:String,attr:"message"},title:{type:String,attr:"title"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"onCloseProgress",method:"onCloseProgress",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".progress[data-p2v-progress]{width:460px;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:20px 0;border-radius:2px;box-shadow:0 4px 12px rgba(0,0,0,.15)}.title[data-p2v-progress]{font-family:Avenir;font-size:2rem;font-weight:700;font-variant-caps:small-caps;color:#7fffd4}"},enumerable:!0,configurable:!0}),e}(),a=(function(e){!function(){var t={}.hasOwnProperty;function n(){for(var e=[],r=0;r<arguments.length;r++){var o=arguments[r];if(o){var i=typeof o;if("string"===i||"number"===i)e.push(o);else if(Array.isArray(o))e.push(n.apply(null,o));else if("object"===i)for(var s in o)t.call(o,s)&&o[s]&&e.push(s)}}return e.join(" ")}e.exports?e.exports=n:window.classNames=n}()}(o={exports:{}}),o.exports),c=function(){function e(){var e=this;this.screenshots=[],this.encodeVideo=function(t){var n=new Blob(t);e.videoUrl=URL.createObjectURL(n)},this.painting=function(t){return new Promise(function(n){var r=function(o){void 0===o&&(o=0),o>=t.length?n():(e.context.fillStyle="rgb(255,255,255)",e.context.fillRect(0,0,e.canvas.width,e.canvas.height),e.context.drawImage(t[o].img,0,0),setTimeout(function(){return r(o+1)},e.settings.frameRate))};r()})}}return e.prototype.componentDidLoad=function(){var e=this;this.canvas=this.recordEl.shadowRoot.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.video=this.recordEl.shadowRoot.querySelector("video"),this.video.addEventListener("end",function(){return URL.revokeObjectURL(e.videoUrl)})},e.prototype.screenshotsUpdate=function(e,t){return n=this,r=void 0,i=function(){var n,r,o,i,s=this;return __generator(this,function(a){switch(a.label){case 0:return e===t||0===e.length?[2]:(this.p2vProgressUpdate.emit({show:!0,title:"Recording..."}),this.videoUrl="",r=(n=e).reduce(function(e,t){return e.width>t.width?e:t}).width,o=n.reduce(function(e,t){return e.height>t.height?e:t}).height,this.canvas.width=r,this.canvas.height=o,(i=new MediaRecorder(this.canvas.captureStream(this.settings.frameRate),{mimeType:this.settings.videoType})).ondataavailable=function(e){return s.encodeVideo([e.data])},i.start(),[4,this.painting(n)]);case 1:return a.sent(),i.stop(),this.p2vProgressUpdate.emit({show:!1}),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){t.done?e(t.value):new o(function(e){e(t.value)}).then(s,a)}c((i=i.apply(n,r||[])).next())});var n,r,o,i},e.prototype.render=function(){return t("div",null,t("video",{controls:!0,class:a({hide:!this.videoUrl}),src:this.videoUrl}),t("canvas",{class:a({hide:this.videoUrl})}))},Object.defineProperty(e,"is",{get:function(){return"p2v-record"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{canvas:{state:!0},context:{state:!0},recordEl:{elementRef:!0},screenshots:{type:"Any",attr:"screenshots",watchCallbacks:["screenshotsUpdate"]},settings:{type:"Any",attr:"settings"},video:{state:!0},videoUrl:{state:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"p2vProgressUpdate",method:"p2vProgressUpdate",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".hide[data-p2v-record]{display:none}"},enumerable:!0,configurable:!0}),e}(),l=["video/webm","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm;codecs=h264","video/mpeg"].filter(function(e){return MediaRecorder.isTypeSupported(e)}),u=function(){function e(){}return e.prototype.componentDidLoad=function(){this.p2vSettingsUpdate.emit(Object.assign({},this.settings,{videType:l[0]}))},e.prototype.render=function(){var e=this;return t("div",null,t("div",{class:"setting-field"},t("div",{class:"setting-name"},"Frame Rate"),t("input",{type:"number",value:this.settings.frameRate})),t("div",{class:"setting-field"},t("div",{class:"setting-name"},"Video Codec"),t("select",null,l.map(function(n){return t("option",{value:n,selected:e.settings.videoType===n},n)}))))},Object.defineProperty(e,"is",{get:function(){return"p2v-settings"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{settings:{type:"Any",attr:"settings"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"p2vSettingsUpdate",method:"p2vSettingsUpdate",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".setting-field[data-p2v-settings]{margin-bottom:10px}.setting-field[data-p2v-settings]:last-child{margin-bottom:0}.setting-name[data-p2v-settings]{font-size:14px}"},enumerable:!0,configurable:!0}),e}(),d=function(){function e(){var e=this;this.progress={show:!1,title:"",message:""},this.settings={frameRate:16,videoType:""},this.handleLoadProfile=function(t){e.screenshots=t.detail}}return e.prototype.updateProgress=function(e){this.progress=e.detail},e.prototype.progressFailed=function(e){console.log("profileLoadFailed: ",e.detail)},e.prototype.p2vSettingsUpdate=function(e){this.settings=e.detail},e.prototype.render=function(){return t("div",{class:"performance-to-video"},t("p2v-settings",{class:"settings",settings:this.settings}),t("p2v-load-profile",{onLoadProfile:this.handleLoadProfile}),t("p2v-progress",{class:a("p2v-progress",{show:this.progress.show}),title:this.progress.title,message:this.progress.message}),t("p2v-record",{class:a("record",{collapsed:!this.screenshots}),settings:this.settings,screenshots:this.screenshots}))},Object.defineProperty(e,"is",{get:function(){return"performance-to-video"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{progress:{state:!0},screenshots:{state:!0},settings:{state:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".performance-to-video[data-performance-to-video]{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.p2v-progress[data-performance-to-video]{position:fixed;display:flex;top:-100%;width:100%;height:100%;opacity:0;overflow:hidden;box-sizing:border-box;align-items:center;justify-content:center;transition:all ease .3s}.p2v-progress.show[data-performance-to-video]{opacity:1;top:0}.collapsed[data-performance-to-video]{height:0}.settings[data-performance-to-video]{position:fixed;top:20px;right:20px;background:#f8f8f8;box-shadow:0 0 1px #0000001f;padding:20px;border-radius:2px}"},enumerable:!0,configurable:!0}),e}();e.P2vLoadProfile=i,e.P2vProgress=s,e.P2vRecord=c,e.P2vSettings=u,e.PerformanceToVideo=d,Object.defineProperty(e,"__esModule",{value:!0})});